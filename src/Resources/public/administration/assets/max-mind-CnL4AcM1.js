const c='{% block sw_order_list_grid_columns_delivery_address %} <template #column-deliveries.id="{ item }"> <template v-if="item.deliveries && item.deliveries[0] && item.deliveries[0].shippingOrderAddress"> <div v-tooltip="{ showDelay: 300, width: 400, disabled: item.deliveries.length <= 1, message: deliveryTooltip(item.deliveries) }" class="sw-order-list__delivery_address"> {{ item.deliveries[0].shippingOrderAddress.street }}, {{ item.deliveries[0].shippingOrderAddress.city }}, {{ getStateNameById(item.deliveries[0].shippingOrderAddress.countryStateId) }}, {{ item.deliveries[0].shippingOrderAddress.zipcode }} </div> </template> </template> {% endblock %} {% block sw_order_list_grid_columns_amount %} <template #column-amountTotal="{ item }"> {{ (item.amountTotal).toFixed(2) }} {{ item.currency.translated.shortName }} </template> {% endblock %}',{Component:d}=Shopware;d.override("sw-order-list",{template:c,inject:["repositoryFactory"],data(){return{loadedStates:{}}},watch:{orders:{handler(){this.loadCountryStates()},immediate:!0,deep:!0}},computed:{orderColumns(){const e=this.$super("orderColumns");return e.push({property:"customFields.maxmind_fraud_risk",label:"Fraud Risk Score",allowResize:!0,align:"right",sortable:!0,rawData:!0,renderer(t,s){var r;const a=(r=s==null?void 0:s.customFields)==null?void 0:r.maxmind_fraud_risk;return a!=null?parseFloat(a):"-"}}),e}},methods:{async loadCountryStates(){const e=this.repositoryFactory.create("country_state"),t=[...new Set((this.orders||[]).map(a=>{var r,i,n;return(n=(i=(r=a==null?void 0:a.deliveries)==null?void 0:r[0])==null?void 0:i.shippingOrderAddress)==null?void 0:n.countryStateId}).filter(Boolean))];if(!t.length)return;const s=new Shopware.Data.Criteria(1,100);s.addFilter(Shopware.Data.Criteria.equalsAny("id",t));try{const a=await e.search(s);this.loadedStates=a.reduce((r,i)=>(r[i.id]=i,r),{})}catch(a){console.error("Failed to load country states:",a)}},getStateNameById(e){var t,s;return((s=(t=this.loadedStates)==null?void 0:t[e])==null?void 0:s.name)??""}}});const l=`{% block sw_order_detail_general %} <sw-card v-if="hasMaxMindData"> <div class="sw-order-detail-general__maxmind-risk-scores"> <span class="h2"> {{ $tc('sw-order-detail-general.maxmindRiskScores.title') }} </span> <div class="sw-order-detail-general__maxmind-scores"> <div class="sw-order-detail-general__maxmind-score"> <strong>{{ $tc('sw-order-detail-general.maxmindRiskScores.fraudRisk') }}</strong> <span>{{ fraudScore }}</span> </div> <div class="sw-order-detail-general__maxmind-score"> <strong>{{ $tc('sw-order-detail-general.maxmindRiskScores.overallRiskScore') }}</strong> <span>{{ overallRiskScore }}</span> </div> <div class="sw-order-detail-general__maxmind-score"> <strong>{{ $tc('sw-order-detail-general.maxmindRiskScores.ipRiskScore') }}</strong> <span>{{ ipRiskScore }}</span> </div> </div> <div class="sw-order-detail-general__maxmind-actions"> <sw-button variant="primary" @click="openMaxMind" > {{ $tc('sw-order-detail-general.maxmindFraudDetection.viewInMaxMind') }} </sw-button> <sw-button variant="secondary" :disabled="!transactionId" @click="copyTransactionId" > {{ $tc('sw-order-detail-general.maxmindFraudDetection.copyTransactionId') }} </sw-button> <sw-button variant="secondary" :disabled="!warningsFactors.length" @click="toggleWarningsFactors" > {{ $tc('sw-order-detail-general.maxmindFraudDetection.viewWarningsFactors') }} </sw-button> </div> <div v-if="showWarningsFactors" class="sw-order-detail-general__maxmind-warnings-factors"> <ul> <li v-for="factor in warningsFactors" :key="factor">{{ factor }}</li> </ul> </div> </div> </sw-card> {% parent() %} {% endblock %}`;Shopware.Component.override("sw-order-detail-general",{template:l,data(){return{showWarningsFactors:!1}},computed:{fraudScore(){var e;return!((e=this.order)!=null&&e.customFields)||this.order.customFields.maxmind_fraud_risk===void 0?"N/A":this.order.customFields.maxmind_fraud_risk},overallRiskScore(){var e,t;return((t=(e=this.order)==null?void 0:e.customFields)==null?void 0:t.maxmind_overall_risk_score)||"N/A"},ipRiskScore(){var e,t;return((t=(e=this.order)==null?void 0:e.customFields)==null?void 0:t.maxmind_ip_risk_score)||"N/A"},transactionId(){var e,t;return((t=(e=this.order)==null?void 0:e.customFields)==null?void 0:t.maxmind_transaction_id)||""},transactionUrl(){var e,t;return((t=(e=this.order)==null?void 0:e.customFields)==null?void 0:t.maxmind_transaction_url)||"#"},warningsFactors(){var t,s;const e=((s=(t=this.order)==null?void 0:t.customFields)==null?void 0:s.maxmind_warnings_factors)||[];return Array.isArray(e)?e:[]},hasMaxMindData(){return this.fraudScore!=="N/A"||this.overallRiskScore!=="N/A"||this.ipRiskScore!=="N/A"||this.transactionId||this.transactionUrl!=="#"||this.warningsFactors.length>0}},methods:{openMaxMind(){this.transactionUrl&&this.transactionUrl!=="#"?window.top.open(this.transactionUrl,"_blank"):this.createNotificationError({title:"MaxMind",message:"No valid transaction URL found."})},copyTransactionId(){if(!this.transactionId){this.createNotificationError({message:this.$tc("sw-order-detail-general.maxmindFraudDetection.noTransactionId")});return}navigator.clipboard.writeText(this.transactionId).then(()=>{this.createNotificationSuccess({message:this.$tc("sw-order-detail-general.maxmindFraudDetection.transactionIdCopied")})}).catch(()=>{this.createNotificationError({message:this.$tc("sw-order-detail-general.maxmindFraudDetection.copyFailed")})})},toggleWarningsFactors(){this.showWarningsFactors=!this.showWarningsFactors}}});const u='{% block sw_order_list_grid_columns_state %} <template #column-stateMachineState.name="{ item }"> <div class="sw-order-list__state"> <sw-color-badge :color="getVariantFromOrderState(item)" :class="getStatusBadgeClass(item.stateMachineState.technicalName)" rounded /> {{ item.stateMachineState.translated.name }} </div> </template> {% endblock %}';Shopware.Component.override("sw-order-list",{template:u,methods:{getStatusBadgeClass(e){switch(e){case"fraud_pass":return"sw-color-badge--fraud-pass";case"fraud_review":return"sw-color-badge--fraud-review";case"fraud_fail":return"sw-color-badge--fraud-fail";case"in_progress":return"sw-color-badge--in-progress";case"completed":return"sw-color-badge--completed";case"cancelled":return"sw-color-badge--cancelled";default:return""}},getVariantFromOrderState(e){switch(e.stateMachineState.technicalName){case"in_progress":return"primary";case"completed":return"success";case"cancelled":return"danger";case"open":return"neutral";case"fraud_pass":return"success";case"fraud_review":return"primary";case"fraud_fail":return"danger";default:return"neutral"}}}});const m=`{% block sw_order_detail_base_general_info_order_states_order %} <div class="sw-order-general-info__order-state"> <sw-order-state-select-v2 v-tooltip="{ message: $tc('sw-privileges.tooltip.warning'), disabled: acl.can('order.editor'), showOnDisabledElements: true }" class="sw-order-general-info__order-state-order" :class="getBackgroundStyle()" :transition-options="orderStateOptions" rounded-style state-type="order" :placeholder="order.stateMachineState.translated.name" :label="$tc('sw-order.stateCard.headlineOrderState')" :disabled="!acl.can('order.editor')" @state-select="onStateSelected" /> </div> {% endblock %}`;Shopware.Component.override("sw-order-general-info",{template:m,methods:{getBackgroundStyle(){switch(this.order.stateMachineState.technicalName){case"in_progress":return"sw-order-state__progress-select";case"completed":return"sw-order-state__completed-select";case"cancelled":return"sw-order-state__cancelled-select";case"open":return"sw-order-state__open-select";case"fraud_pass":return"sw-order-state__completed-select";case"fraud_review":return"sw-order-state__progress-select";case"fraud_fail":return"sw-order-state__cancelled-select";default:return"sw-order-state__open-select"}}}});const g={"sw-order-detail-general":{maxmindRiskScores:{title:"MaxMind Risk Scores",fraudRisk:"Fraud Risk Score",overallRiskScore:"Overall Risk Score",ipRiskScore:"IP Address Risk Score"},maxmindFraudDetection:{title:"MaxMind Fraud Detection",viewInMaxMind:"View in MaxMind",copyTransactionId:"Copy Transaction ID",viewWarningsFactors:"View Warnings & Factors",noTransactionId:"No Transaction ID available.",transactionIdCopied:"Transaction ID copied to clipboard!",copyFailed:"Failed to copy Transaction ID."},"fraud-risk-score":{title:"Fraud Risk Score"}},"solu1-maxmind-config":{apiTest:{button:"Test API Connection",successTitle:"Connection successful",successMessage:"The MaxMind credentials are valid.",errorTitle:"Connection failed",errorMessage:"The connection test failed.",missingCredentials:"Please enter your Account ID and License Key before running the test."}}},p={"sw-order-detail-general":{maxmindRiskScores:{title:"MaxMind Risikobewertungen",fraudRisk:"Betrugsrisiko",overallRiskScore:"Gesamtrisiko",ipRiskScore:"IP-Adressrisiko"},maxmindFraudDetection:{title:"MaxMind Betrugserkennung",viewInMaxMind:"In MaxMind anzeigen",copyTransactionId:"Transaktions-ID kopieren",viewWarningsFactors:"Warnungen & Faktoren anzeigen",noTransactionId:"Keine Transaktions-ID verfügbar.",transactionIdCopied:"Transaktions-ID wurde in die Zwischenablage kopiert!",copyFailed:"Kopieren der Transaktions-ID fehlgeschlagen."},"fraud-risk-score":{title:"Betrugsrisiko-Score Test"}},"solu1-maxmind-config":{apiTest:{button:"API-Verbindung testen",successTitle:"Verbindung erfolgreich",successMessage:"Die MaxMind-Zugangsdaten sind gültig.",errorTitle:"Verbindung fehlgeschlagen",errorMessage:"Der Verbindungstest ist fehlgeschlagen.",missingCredentials:"Bitte geben Sie Account-ID und Lizenzschlüssel ein, bevor Sie den Test starten."}}},h=`{% block solu1_maxmind_api_test_button %} <div class="solu1-maxmind-api-test"> <sw-button-process :is-loading="isLoading" :process-success="isSaveSuccessful" @process-finish="onProcessFinish" @click="checkConnection" > {{ $tc('solu1-maxmind-config.apiTest.button') }} </sw-button-process> </div> {% endblock %}`,{Component:w,Mixin:f}=Shopware;w.register("maxmind-api-test",{template:h,inject:["MaxMindApiTestService"],mixins:[f.getByName("notification")],data(){return{isLoading:!1,isSaveSuccessful:!1}},computed:{pluginConfig(){const e=this.getConfigParent();if(!e||!e.actualConfigData)return{};const t=this.getCurrentSalesChannelId()??"null";return e.actualConfigData[t]??e.actualConfigData.null??{}}},methods:{onProcessFinish(){this.isSaveSuccessful=!1},getConfigParent(){let e=this.$parent;for(;e&&typeof e.actualConfigData>"u";)e=e.$parent;return e??null},getCurrentSalesChannelId(){let e=this.$parent;for(;e&&typeof e.currentSalesChannelId>"u";)e=e.$parent;return e?e.currentSalesChannelId:null},buildPayload(){const e=this.pluginConfig;return{accountId:e["MaxMind.config.MaxMindConfigAccountId"]??e.MaxMindConfigAccountId??null,licenseKey:e["MaxMind.config.MaxMindConfigLicenseKey"]??e.MaxMindConfigLicenseKey??null,salesChannelId:this.getCurrentSalesChannelId()}},checkConnection(){const e=this.buildPayload();if(!e.accountId||!e.licenseKey){this.createNotificationError({title:this.$tc("solu1-maxmind-config.apiTest.errorTitle"),message:this.$tc("solu1-maxmind-config.apiTest.missingCredentials")});return}this.isLoading=!0,this.MaxMindApiTestService.check(e).then(t=>{if(t!=null&&t.success){this.isSaveSuccessful=!0,this.createNotificationSuccess({title:this.$tc("solu1-maxmind-config.apiTest.successTitle"),message:t.message??this.$tc("solu1-maxmind-config.apiTest.successMessage")});return}this.createNotificationError({title:this.$tc("solu1-maxmind-config.apiTest.errorTitle"),message:(t==null?void 0:t.message)??this.$tc("solu1-maxmind-config.apiTest.errorMessage")})}).catch(t=>{var a,r;const s=((r=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:r.message)??(t==null?void 0:t.message)??"";this.createNotificationError({title:this.$tc("solu1-maxmind-config.apiTest.errorTitle"),message:s||this.$tc("solu1-maxmind-config.apiTest.errorMessage")})}).finally(()=>{this.isLoading=!1})}}});const{ApiService:o}=Shopware.Classes;class _ extends o{constructor(t,s,a="solu1-maxmind/test-connection"){super(t,s,a)}check(t={}){const s=this.getBasicHeaders();return this.httpClient.post(`_action/${this.getApiBasePath()}`,t,{headers:s}).then(a=>o.handleResponse(a))}}Shopware.Locale.extend("en-GB",g);Shopware.Locale.extend("de-DE",p);Shopware.Service().register("MaxMindApiTestService",()=>new _(Shopware.Application.getContainer("init").httpClient,Shopware.Service("loginService")));
//# sourceMappingURL=max-mind-CnL4AcM1.js.map
